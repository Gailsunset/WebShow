<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ€ç³»ç»Ÿé£Ÿç‰©é“¾å¯è§†åŒ–å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .step {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .step-title {
            font-size: 1.4em;
            color: #4a5568;
            margin-bottom: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .step-number {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .typography-highlight {
            font-weight: bold;
            color: #667eea;
            font-style: italic;
        }
        
        .feature-list {
            list-style: none;
            padding-left: 0;
        }
        
        .feature-list li {
            background: #f7fafc;
            margin: 12px 0;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            position: relative;
        }
        
        .feature-list li:before {
            content: "âœ“";
            color: #48bb78;
            font-weight: bold;
            margin-right: 10px;
            font-size: 1.1em;
        }
        
        .flowchart {
            background: #f8f9fa;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.8;
            color: #4a5568;
        }
        
        .flowchart-step {
            margin: 8px 0;
            padding: 5px 0;
        }
        
        .flowchart-arrow {
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .ecosystem-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .ecosystem-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .ecosystem-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            border-color: #667eea;
        }
        
        .ecosystem-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #4c51bf;
        }
        
        .canvas-area {
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            min-height: 300px;
            background: #fafafa;
            position: relative;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
        }
        
        .biological-node {
            background: white;
            border: 2px solid #667eea;
            border-radius: 25px;
            padding: 8px 15px;
            cursor: grab;
            user-select: none;
            font-size: 0.9em;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
            position: absolute;
        }
        
        .biological-node:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .biological-node:active {
            cursor: grabbing;
        }
        
        .node-producer {
            border-color: #48bb78;
            background: #f0fff4;
            color: #2f855a;
        }
        
        .node-primary {
            border-color: #4299e1;
            background: #ebf8ff;
            color: #2b6cb0;
        }
        
        .node-secondary {
            border-color: #ed8936;
            background: #fffbf0;
            color: #c05621;
        }
        
        .node-tertiary {
            border-color: #9f7aea;
            background: #faf5ff;
            color: #6b46c1;
        }
        
        .dragging {
            opacity: 0.8;
            z-index: 1000;
            transform: rotate(5deg);
        }
        
        .action-buttons {
            text-align: center;
            margin: 20px 0;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .nutrition-label {
            font-size: 0.7em;
            background: rgba(102, 126, 234, 0.1);
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
            font-weight: normal;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ± ç”Ÿæ€ç³»ç»Ÿé£Ÿç‰©é“¾å¯è§†åŒ–å·¥å…·</h1>
            <p>ç›´è§‚å­¦ä¹ ç”Ÿæ€é£Ÿç‰©é“¾æ„æˆä¸å…³ç³»çš„æ™ºèƒ½è¾…åŠ©å·¥å…·</p>
        </div>

        <div class="step">
            <div class="step-title">
                <span class="step-number">1</span>
                å…¸å‹ç”¨æˆ·ç”»åƒ
            </div>
            <p><span class="typography-highlight">ä¸€å¥è¯æè¿°ï¼š</span>éœ€è¦ç›´è§‚å­¦ä¹ ã€å±•ç¤ºç”Ÿæ€ç³»ç»Ÿé£Ÿç‰©é“¾æ„æˆä¸å…³ç³»çš„<span class="typography-highlight">å­¦ç”Ÿï¼ˆä¸­å°å­¦ / å¤§å­¦ï¼‰åŠç§‘æ™®çˆ±å¥½è€…</span>ï¼Œ<span class="typography-highlight">æ ¸å¿ƒç—›ç‚¹æ˜¯æŠ½è±¡çŸ¥è¯†éš¾ç†è§£ã€ç¼ºä¹ä¾¿æ·å¯è§†åŒ–å·¥å…·</span>ã€‚</p>
        </div>

        <div class="step">
            <div class="step-title">
                <span class="step-number">2</span>
                åœºæ™¯æ•…äº‹
            </div>
            <p><span class="typography-highlight">ä¸€å¥è¯æè¿°ï¼š</span>åˆä¸­ç”Ÿå°æä¸ºå®Œæˆç”Ÿç‰©è¯¾é£Ÿç‰©é“¾ä½œä¸šï¼Œé€šè¿‡äº§å“å¿«é€Ÿé€‰æ‹©ç”Ÿæ€ç±»å‹ï¼ˆå¦‚æ£®æ— / æµ·æ´‹ï¼‰ã€æ·»åŠ ç”Ÿç‰©èŠ‚ç‚¹ã€è‡ªåŠ¨ç”Ÿæˆå¯è§†åŒ–é£Ÿç‰©é“¾å›¾è°±ï¼Œ<span class="typography-highlight">è½»æ¾å®Œæˆä½œä¸šå¹¶ç†è§£ç”Ÿç‰©é—´ä¾å­˜å…³ç³»</span>ã€‚</p>
        </div>

        <div class="step">
            <div class="step-title">
                <span class="step-number">3</span>
                åŠŸèƒ½ç‰¹æ€§
            </div>
            <ul class="feature-list">
                <li>æ”¯æŒ <span class="typography-highlight">3 ç§åŸºç¡€ç”Ÿæ€ç±»å‹é€‰æ‹©</span>ï¼ˆæ£®æ—ã€æµ·æ´‹ã€è‰åŸï¼‰</li>
                <li>æä¾›å¯¹åº”ç”Ÿæ€çš„ <span class="typography-highlight">10 ç§æ ¸å¿ƒç”Ÿç‰©æ ‡ç­¾</span>ï¼ˆç”Ÿäº§è€… / åˆçº§æ¶ˆè´¹è€… / æ¬¡çº§æ¶ˆè´¹è€…å„ 3-4 ç§ï¼‰</li>
                <li>æ”¯æŒ <span class="typography-highlight">æ‹–æ‹½ç”Ÿç‰©æ ‡ç­¾ç”Ÿæˆé£Ÿç‰©é“¾é“¾è·¯</span>ï¼ˆæœ€å¤š 5 ä¸ªèŠ‚ç‚¹ï¼‰</li>
                <li><span class="typography-highlight">è‡ªåŠ¨æ ‡æ³¨ç”Ÿç‰©è¥å…»çº§</span>ï¼ˆç”Ÿäº§è€… / åˆçº§æ¶ˆè´¹è€… / æ¬¡çº§æ¶ˆè´¹è€… / ä¸‰çº§æ¶ˆè´¹è€…ï¼‰</li>
                <li>ç”Ÿæˆ<span class="typography-highlight">ç®€çº¦å¯è§†åŒ–é£Ÿç‰©é“¾å›¾è°±</span>ï¼ˆå¯æˆªå›¾ä¿å­˜ï¼‰</li>
            </ul>
        </div>

        <div class="step">
            <div class="step-title">
                <span class="step-number">4</span>
                äº¤äº’æµç¨‹
            </div>
            <div class="flowchart">
                <div class="flowchart-step">A[<span class="typography-highlight">ç”¨æˆ·æ‰“å¼€äº§å“</span>] <span class="flowchart-arrow">â†’</span></div>
                <div class="flowchart-step">B[<span class="typography-highlight">é€‰æ‹©ç”Ÿæ€ç±»å‹<br>ï¼ˆæ£®æ—/æµ·æ´‹/è‰åŸï¼‰</span>] <span class="flowchart-arrow">â†’</span></div>
                <div class="flowchart-step">C[<span class="typography-highlight">è¿›å…¥ç¼–è¾‘é¡µ<br>æŸ¥çœ‹ç”Ÿç‰©æ ‡ç­¾åº“</span>] <span class="flowchart-arrow">â†’</span></div>
                <div class="flowchart-step">D[<span class="typography-highlight">æ‹–æ‹½ç”Ÿç‰©æ ‡ç­¾è‡³ç”»å¸ƒ<br>ï¼ˆæœ€å¤š5ä¸ªèŠ‚ç‚¹ï¼Œç³»ç»Ÿæç¤ºæ’åºï¼‰</span>] <span class="flowchart-arrow">â†’</span></div>
                <div class="flowchart-step">E[<span class="typography-highlight">ç‚¹å‡»"ç”Ÿæˆå›¾è°±"æŒ‰é’®</span>] <span class="flowchart-arrow">â†’</span></div>
                <div class="flowchart-step">F[<span class="typography-highlight">è‡ªåŠ¨æ ‡æ³¨è¥å…»çº§<br>ï¼ˆç”Ÿäº§è€…/åˆçº§/æ¬¡çº§/ä¸‰çº§æ¶ˆè´¹è€…ï¼‰</span>] <span class="flowchart-arrow">â†’</span></div>
                <div class="flowchart-step">G[<span class="typography-highlight">ç”Ÿæˆå¯è§†åŒ–å›¾è°±</span>] <span class="flowchart-arrow">â†’</span></div>
                <div class="flowchart-step">H[<span class="typography-highlight">ç”¨æˆ·æˆªå›¾ä¿å­˜å›¾è°±</span>]</div>
            </div>
        </div>

        <div class="step">
            <div class="step-title">
                <span class="step-number">5</span>
                äº¤äº’æ¼”ç¤ºåŒºåŸŸ
            </div>
            <div style="text-align: center; margin-bottom: 20px;">
                <label style="font-weight: bold; margin-right: 15px;">é€‰æ‹©ç”Ÿæ€ç±»å‹ï¼š</label>
                <div class="ecosystem-cards">
                    <div class="ecosystem-card selected" onclick="selectEcosystem('forest')" data-eco="forest">
                        ğŸŒ² æ£®æ—ç”Ÿæ€
                    </div>
                    <div class="ecosystem-card" onclick="selectEcosystem('ocean')" data-eco="ocean">
                        ğŸŒŠ æµ·æ´‹ç”Ÿæ€
                    </div>
                    <div class="ecosystem-card" onclick="selectEcosystem('grassland')" data-eco="grassland">
                        ğŸŒ¾ è‰åŸç”Ÿæ€
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn" onclick="resetCanvas()">ğŸ”„ é‡ç½®ç”»å¸ƒ</button>
                <button class="btn" id="generateBtn" onclick="generateFoodChain()" disabled>ğŸ¯ ç”Ÿæˆå›¾è°±</button>
            </div>

            <div class="canvas-area" id="canvasArea" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div style="color: #a0aec0; text-align: center; font-size: 1.1em;">
                    ğŸ–±ï¸ ä»ä¸‹æ–¹æ‹–æ‹½ç”Ÿç‰©åˆ°æ­¤åŒºåŸŸå¼€å§‹æ„å»ºé£Ÿç‰©é“¾<br>
                    <small>ï¼ˆæœ€å¤šé€‰æ‹©5ä¸ªç”Ÿç‰©èŠ‚ç‚¹ï¼‰</small>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <div id="selectedCount" style="color: #667eea; font-weight: bold;">å·²é€‰æ‹© 0 ä¸ªç”Ÿç‰©èŠ‚ç‚¹</div>
            </div>
        </div>
    </div>

    <script>
        let currentEcosystem = 'forest';
        let selectedNodes = [];
        let nodeCounter = 0;
        const maxNodes = 5;

        // ä¸åŒç”Ÿæ€ç³»ç»Ÿçš„ç”Ÿç‰©æ•°æ®
        const ecosystemData = {
            forest: {
                name: 'æ£®æ—ç”Ÿæ€',
                producers: [
                    {name: 'æ ‘æœ¨', type: 'producer'},
                    {name: 'çŒæœ¨', type: 'producer'}, 
                    {name: 'è‰æœ¬æ¤ç‰©', type: 'producer'},
                    {name: 'è‹”è—“', type: 'producer'}
                ],
                primary: [
                    {name: 'å…”å­', type: 'primary'},
                    {name: 'é¹¿', type: 'primary'},
                    {name: 'æ¾é¼ ', type: 'primary'},
                    {name: 'æ˜†è™«', type: 'primary'}
                ],
                secondary: [
                    {name: 'ç‹ç‹¸', type: 'secondary'},
                    {name: 'çŒ«å¤´é¹°', type: 'secondary'},
                    {name: 'è›‡', type: 'secondary'},
                    {name: 'é¸Ÿç±»', type: 'secondary'}
                ]
            },
            ocean: {
                name: 'æµ·æ´‹ç”Ÿæ€',
                producers: [
                    {name: 'æµ®æ¸¸æ¤ç‰©', type: 'producer'},
                    {name: 'æµ·è—»', type: 'producer'},
                    {name: 'æµ·è‰', type: 'producer'},
                    {name: 'çŠç‘š', type: 'producer'}
                ],
                primary: [
                    {name: 'å°é±¼', type: 'primary'},
                    {name: 'è™¾', type: 'primary'},
                    {name: 'æµ®æ¸¸åŠ¨ç‰©', type: 'primary'},
                    {name: 'è´ç±»', type: 'primary'}
                ],
                secondary: [
                    {name: 'é²¨é±¼', type: 'secondary'},
                    {name: 'æµ·è±š', type: 'secondary'},
                    {name: 'é‡‘æªé±¼', type: 'secondary'},
                    {name: 'ç« é±¼', type: 'secondary'}
                ]
            },
            grassland: {
                name: 'è‰åŸç”Ÿæ€',
                producers: [
                    {name: 'è‰åŸè‰', type: 'producer'},
                    {name: 'é‡èŠ±', type: 'producer'},
                    {name: 'çŒæœ¨ä¸›', type: 'producer'},
                    {name: 'ä»™äººæŒ', type: 'producer'}
                ],
                primary: [
                    {name: 'ç¾šç¾Š', type: 'primary'},
                    {name: 'é‡å…”', type: 'primary'},
                    {name: 'åœŸæ‹¨é¼ ', type: 'primary'},
                    {name: 'è—è™«', type: 'primary'}
                ],
                secondary: [
                    {name: 'ç‹®å­', type: 'secondary'},
                    {name: 'ç‹¼', type: 'secondary'},
                    {name: 'é¹°', type: 'secondary'},
                    {name: 'ç‹ç‹¸', type: 'secondary'}
                ]
            }
        };

        function selectEcosystem(ecoType) {
            currentEcosystem = ecoType;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.ecosystem-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-eco="${ecoType}"]`).classList.add('selected');
            
            resetCanvas();
        }

        function getAllBiologicalNodes() {
            const data = ecosystemData[currentEcosystem];
            return [...data.producers, ...data.primary, ...data.secondary];
        }

        function createBiologicalNodes() {
            const canvas = document.getElementById('canvasArea');
            const existingNodes = canvas.querySelectorAll('.biological-node');
            existingNodes.forEach(node => node.remove());

            const nodes = getAllBiologicalNodes();
            const nodeContainer = document.createElement('div');
            nodeContainer.style.position = 'relative';
            nodeContainer.style.minHeight = '200px';
            nodeContainer.style.display = 'flex';
            nodeContainer.style.flexWrap = 'wrap';
            nodeContainer.style.gap = '10px';
            nodeContainer.style.justifyContent = 'center';
            nodeContainer.style.alignItems = 'center';
            nodeContainer.style.padding = '20px';

            nodes.forEach((bio, index) => {
                const node = document.createElement('div');
                node.className = `biological-node node-${bio.type}`;
                node.draggable = true;
                node.id = `source-${index}`;
                node.textContent = bio.name;
                node.style.margin = '5px';
                
                // æ·»åŠ è¥å…»çº§æ ‡è¯†
                const nutritionLabels = {
                    'producer': '<span class="nutrition-label">ç”Ÿäº§è€…</span>',
                    'primary': '<span class="nutrition-label">åˆçº§æ¶ˆè´¹è€…</span>',
                    'secondary': '<span class="nutrition-label">æ¬¡çº§æ¶ˆè´¹è€…</span>'
                };
                node.innerHTML = bio.name + nutritionLabels[bio.type];

                node.addEventListener('dragstart', handleDragStart);
                node.addEventListener('dragend', handleDragEnd);
                nodeContainer.appendChild(node);
            });

            // æ¸…é™¤åŸæœ‰å†…å®¹ï¼Œä¿ç•™æç¤ºæ–‡å­—
            canvas.innerHTML = '';
            constæç¤ºæ–‡å­— = document.createElement('div');
            æç¤ºæ–‡å­—.style.color = '#a0aec0';
            æç¤ºæ–‡å­—.style.textAlign = 'center';
            æç¤ºæ–‡å­—.style.fontStyle = 'italic';
            æç¤ºæ–‡å­—.style.marginTop = '50px';
            æç¤ºæ–‡å­—.innerHTML = 'ğŸ–±ï¸ ä»ä¸Šæ–¹æ‹–æ‹½ç”Ÿç‰©åˆ°ä¸‹æ–¹åŒºåŸŸå¼€å§‹æ„å»ºé£Ÿç‰©é“¾<br><small>ï¼ˆæœ€å¤šé€‰æ‹©5ä¸ªç”Ÿç‰©èŠ‚ç‚¹ï¼‰</small>';
            canvas.appendChild(æç¤ºæ–‡å­—);
            
            canvas.appendChild(nodeContainer);
        }

        function resetCanvas() {
            selectedNodes = [];
            nodeCounter = 0;
            createBiologicalNodes();
            updateSelectedCount();
            document.getElementById('generateBtn').disabled = true;
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.id);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function allowDrop(e) {
            e.preventDefault();
        }

        function drop(e) {
            e.preventDefault();
            const data = e.dataTransfer.getData('text/plain');
            const draggedNode = document.getElementById(data);
            
            if (draggedNode && selectedNodes.length < maxNodes) {
                const nodeInfo = getNodeInfo(data);
                if (nodeInfo) {
                    createCanvasNode(nodeInfo, data);
                }
            }
        }

        function getNodeInfo(nodeId) {
            const nodes = getAllBiologicalNodes();
            const sourceNodes = document.querySelectorAll('#canvasArea [id^="source-"]');
            
            for (let i = 0; i < sourceNodes.length; i++) {
                if (sourceNodes[i].id === nodeId) {
                    return nodes[i];
                }
            }
            return null;
        }

        function createCanvasNode(nodeInfo, originalId) {
            const canvas = document.getElementById('canvasArea');
            const existingPrompt = canvas.querySelector('div[style*="margin-top: 50px"]');
            if (existingPrompt) {
                existingPrompt.remove();
            }

            const node = document.createElement('div');
            node.className = `biological-node node-${nodeInfo.type}`;
            node.id = `canvas-node-${nodeCounter}`;
            node.textContent = nodeInfo.name;
            node.style.position = 'relative';
            node.style.cursor = 'move';
            
            // æ·»åŠ è¥å…»çº§æ ‡è¯†
            const nutritionLabels = {
                'producer': '<span class="nutrition-label">ç”Ÿäº§è€…</span>',
                'primary': '<span class="nutrition-label">åˆçº§æ¶ˆè´¹è€…</span>',
                'secondary': '<span class="nutrition-label">æ¬¡çº§æ¶ˆè´¹è€…</span>'
            };
            node.innerHTML = nodeInfo.name + nutritionLabels[nodeInfo.type];

            // æ·»åŠ åˆ é™¤åŠŸèƒ½
            node.style.cursor = 'pointer';
            node.title = 'ç‚¹å‡»åˆ é™¤æ­¤èŠ‚ç‚¹';
            node.onclick = function(e) {
                if (e.detail === 2) { // åŒå‡»åˆ é™¤
                    node.remove();
                    selectedNodes = selectedNodes.filter(n => n.id !== node.id);
                    updateSelectedCount();
                    updateGenerateButton();
                }
            };

            // æ‹–æ‹½æ’åºåŠŸèƒ½ï¼ˆç®€åŒ–ç‰ˆï¼‰
            node.draggable = true;
            node.addEventListener('dragstart', function(e) {
                e.dataTransfer.setData('text/plain', node.id);
            });

            selectedNodes.push({
                id: node.id,
                name: nodeInfo.name,
                type: nodeInfo.type,
                element: node
            });

            canvas.appendChild(node);
            nodeCounter++;
            updateSelectedCount();
            updateGenerateButton();
        }

        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = `å·²é€‰æ‹© ${selectedNodes.length} ä¸ªç”Ÿç‰©èŠ‚ç‚¹`;
        }

        function updateGenerateButton() {
            const btn = document.getElementById('generateBtn');
            btn.disabled = selectedNodes.length < 2 || selectedNodes.length > maxNodes;
        }

        function generateFoodChain() {
            if (selectedNodes.length < 2) {
                alert('è¯·è‡³å°‘é€‰æ‹©2ä¸ªç”Ÿç‰©èŠ‚ç‚¹æ¥æ„å»ºé£Ÿç‰©é“¾ï¼');
                return;
            }

            if (selectedNodes.length > maxNodes) {
                alert(`æœ€å¤šåªèƒ½é€‰æ‹©${maxNodes}ä¸ªç”Ÿç‰©èŠ‚ç‚¹ï¼`);
                return;
            }

            // åˆ†æè¥å…»çº§å¹¶æ’åº
            const sortedChain = analyzeAndSortFoodChain(selectedNodes);
            
            if (sortedChain.length < 2) {
                alert('æ— æ³•æ„å»ºæœ‰æ•ˆçš„é£Ÿç‰©é“¾å…³ç³»ï¼Œè¯·æ£€æŸ¥é€‰æ‹©çš„ç”Ÿç‰©ç±»å‹ï¼');
                return;
            }

            displayFoodChainVisualization(sortedChain);
        }

        function analyzeAndSortFoodChain(nodes) {
            // ç®€åŒ–çš„é£Ÿç‰©é“¾é€»è¾‘ï¼šç”Ÿäº§è€… -> åˆçº§æ¶ˆè´¹è€… -> æ¬¡çº§æ¶ˆè´¹è€…
            const producers = nodes.filter(n => n.type === 'producer');
            const primaryConsumers = nodes.filter(n => n.type === 'primary');
            const secondaryConsumers = nodes.filter(n => n.type === 'secondary');

            let chain = [];

            // å…ˆæ·»åŠ ç”Ÿäº§è€…
            if (producers.length > 0) {
                chain = chain.concat(producers);
            }

            // æ·»åŠ åˆçº§æ¶ˆè´¹è€…
            if (primaryConsumers.length > 0) {
                chain = chain.concat(primaryConsumers);
            }

            // æ·»åŠ æ¬¡çº§æ¶ˆè´¹è€…
            if (secondaryConsumers.length > 0) {
                chain = chain.concat(secondaryConsumers);
            }

            // å¦‚æœæ²¡æœ‰æ˜ç¡®çš„åˆ†ç±»ï¼ŒæŒ‰åŸå§‹é¡ºåºä½†ç¡®ä¿æœ‰ç”Ÿäº§è€…
            if (chain.length === 0 && nodes.length > 0) {
                chain = nodes;
            }

            return chain.slice(0, maxNodes); // æœ€å¤š5ä¸ªèŠ‚ç‚¹
        }

        function displayFoodChainVisualization(chain) {
            const canvas = document.getElementById('canvasArea');
            
            // æ¸…é™¤ç°æœ‰å†…å®¹ï¼ˆä¿ç•™æç¤ºåŒºåŸŸï¼‰
            const existingNodes = canvas.querySelectorAll('.biological-node');
            existingNodes.forEach(node => node.remove());

            // åˆ›å»ºé£Ÿç‰©é“¾å¯è§†åŒ–
            const chainContainer = document.createElement('div');
            chainContainer.style.display = 'flex';
            chainContainer.style.flexDirection = 'column';
            chainContainer.style.alignItems: 'center';
            chainContainer.style.gap = '20px';
            chainContainer.style.padding = '20px';
            chainContainer.style.minHeight = '300px';

            // æ ‡é¢˜
            const title = document.createElement('div');
            title.style.textAlign = 'center';
            title.style.fontWeight = 'bold';
            title.style.fontSize = '1.2em';
            title.style.marginBottom = '20px';
            title.style.color = '#4a5568';
            title.textContent = 'ğŸ”¬ é£Ÿç‰©é“¾å¯è§†åŒ–å›¾è°±';
            chainContainer.appendChild(title);

            // é£Ÿç‰©é“¾èŠ‚ç‚¹
            chain.forEach((node, index) => {
                const nodeElement = document.createElement('div');
                nodeElement.style.display = 'flex';
                nodeElement.style.alignItems = 'center';
                nodeElement.style.justifyContent = 'center';
                nodeElement.style.gap = '10px';
                nodeElement.style.margin = '10px 0';

                // è¥å…»çº§æ ‡ç­¾
                const nutritionLevel = getNutritionLevel(index, chain.length);
                const levelLabel = document.createElement('span');
                levelLabel.style.background = getNutritionColor(nutritionLevel);
                levelLabel.style.color = 'white';
                levelLabel.style.padding = '4px 12px';
                levelLabel.style.borderRadius = '15px';
                levelLabel.style.fontSize = '0.8em';
                levelLabel.style.fontWeight = 'bold';
                levelLabel.textContent = nutritionLevel;

                // ç”Ÿç‰©èŠ‚ç‚¹
                const bioNode = document.createElement('div');
                bioNode.style.background = 'white';
                bioNode.style.padding = '10px 20px';
                bioNode.style.borderRadius = '20px';
                bioNode.style.border = '2px solid #667eea';
                bioNode.style.fontSize = '1.1em';
                bioNode.style.fontWeight = 'bold';
                bioNode.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
                bioNode.style.color = '#333';
                bioNode.textContent = node.name;

                nodeElement.appendChild(levelLabel);
                nodeElement.appendChild(bioNode);
                chainContainer.appendChild(nodeElement);
            });

            // è¯´æ˜æ–‡å­—
            const description = document.createElement('div');
            description.style.textAlign = 'center';
            description.style.marginTop = '20px';
            description.style.color = '#666';
            description.style.fontStyle = 'italic';
            description.innerHTML = `ğŸ’¡ æ­¤é£Ÿç‰©é“¾å…±åŒ…å« ${chain.length} ä¸ªç”Ÿç‰©èŠ‚ç‚¹ï¼Œå±•ç¤ºäº†ä»ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…çš„èƒ½é‡ä¼ é€’å…³ç³»`;

            chainContainer.appendChild(description);
            canvas.appendChild(chainContainer);

            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            chainContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function getNutritionLevel(index, total) {
            if (index === 0) return 'ğŸŒ± ç”Ÿäº§è€…';
            if (index === 1) return 'ğŸ° åˆçº§æ¶ˆè´¹è€…';
            if (index === 2) return 'ğŸ¦Š æ¬¡çº§æ¶ˆè´¹è€…';
            if (index === 3) return 'ğŸ¦… ä¸‰çº§æ¶ˆè´¹è€…';
            return 'ğŸ”„ æ¶ˆè´¹è€…';
        }

        function getNutritionColor(level) {
            const colors = {
                'ğŸŒ± ç”Ÿäº§è€…': '#48bb78',
                'ğŸ° åˆçº§æ¶ˆè´¹è€…': '#4299e1',
                'ğŸ¦Š æ¬¡çº§æ¶ˆè´¹è€…': '#ed8936',
                'ğŸ¦… ä¸‰çº§æ¶ˆè´¹è€…': '#9f7aea',
                'ğŸ”„ æ¶ˆè´¹è€…': '#667eea'
            };
            for (let key in colors) {
                if (level.includes(key.split(' ')[0])) {
                    return colors[key];
                }
            }
            return '#667eea';
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            createBiologicalNodes();
        };
    </script>
</body>
</html>