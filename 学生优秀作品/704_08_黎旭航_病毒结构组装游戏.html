<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>病毒结构组装游戏 (MVP)</title>
    <style>
        /* --- 全局样式 --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1000px;
            height: 600px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            display: none; /* 默认所有屏幕隐藏 */
        }

        .screen.active {
            display: flex; /* 仅显示active的屏幕 */
        }

        h1, h2, h3 {
            color: #2c3e50;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 10px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #2980b9;
        }

        /* --- 1. 启动游戏屏幕 --- */
        #start-screen h1 {
            font-size: 3em;
            margin-bottom: 0.5em;
        }
        #start-screen p {
            font-size: 1.2em;
            color: #7f8c8d;
            margin-bottom: 2em;
        }

        /* --- 2. 选择病毒类型屏幕 --- */
        .virus-selection {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        .virus-card {
            width: 200px;
            padding: 20px;
            border: 2px solid #bdc3c7;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .virus-card:hover {
            border-color: #3498db;
            background-color: #f8f9fa;
            transform: translateY(-5px);
        }
        .virus-card img {
            width: 100px;
            height: 100px;
            object-fit: contain;
            margin-bottom: 10px;
        }

        /* --- 3. 3D组装界面 --- */
        #assembly-screen {
            flex-direction: row;
            justify-content: flex-start;
            align-items: flex-start;
        }
        #assembly-screen h2 {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            margin: 0;
        }
        #timer {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.2em;
            font-weight: bold;
            color: #e74c3c;
        }
        .parts-bin {
            width: 250px;
            height: calc(100% - 40px);
            margin-top: 40px;
            padding: 15px;
            background-color: #ecf0f1;
            border-right: 2px dashed #bdc3c7;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            overflow-y: auto;
            box-sizing: border-box;
        }
        .assembly-area {
            flex-grow: 1;
            height: 100%;
            position: relative;
            background-color: #f9f9f9;
        }
        .drop-zone {
            position: absolute;
            width: 200px;
            height: 200px;
            border: 3px dashed #95a5a6;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            justify-content: center;
            align-items: center;
            color: #95a5a6;
            font-weight: bold;
        }
        .drop-zone.active {
            border-color: #2ecc71;
            background-color: rgba(46, 204, 113, 0.1);
        }
        
        .virus-part {
            width: 100px;
            height: 100px;
            background-color: #9b59b6;
            border-radius: 50%;
            margin: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            cursor: grab;
            user-select: none;
            transition: all 0.2s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .virus-part:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        .virus-part.dragging {
            opacity: 0.7;
            transform: scale(1.1);
        }
        .virus-part.nucleic-acid { background-color: #e74c3c; }
        .virus-part.protein-shell { background-color: #3498db; }
        .virus-part.spike-protein { background-color: #f1c40f; border-radius: 30%; }

        #error-message {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #error-message.show {
            opacity: 1;
        }

        /* --- 4. 成功弹窗 --- */
        #success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            animation: popIn 0.5s forwards;
        }
        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .structure-info {
            text-align: left;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        .structure-info p {
            margin: 8px 0;
            padding: 8px;
            background-color: #f8f9fa;
            border-left: 3px solid #3498db;
        }
    </style>
</head>
<body>

    <div class="container">

        <!-- 1. 启动游戏屏幕 -->
        <div id="start-screen" class="screen active">
            <h1>病毒结构组装游戏</h1>
            <p>通过动手组装，探索微观世界的奥秘</p>
            <button id="start-button">开始游戏</button>
        </div>

        <!-- 2. 选择病毒类型屏幕 -->
        <div id="selection-screen" class="screen">
            <h2>选择一种病毒进行组装</h2>
            <div class="virus-selection">
                <div class="virus-card" data-virus="covid">
                    <img src="https://cdn-icons-png.flaticon.com/512/8239/8239655.png" alt="新冠病毒">
                    <h3>新冠病毒</h3>
                    <p>具有典型的刺突蛋白结构</p>
                </div>
                <div class="virus-card" data-virus="influenza">
                    <img src="https://cdn-icons-png.flaticon.com/512/2892/2892736.png" alt="流感病毒">
                    <h3>流感病毒</h3>
                    <p>分为甲、乙、丙三型</p>
                </div>
            </div>
        </div>

        <!-- 3. 3D组装界面 -->
        <div id="assembly-screen" class="screen">
            <h2>组装 <span id="current-virus-name">病毒</span></h2>
            <div id="timer">时间: 00:00</div>
            <div class="parts-bin" id="parts-bin">
                <!-- 病毒组件将动态生成在这里 -->
            </div>
            <div class="assembly-area">
                <div class="drop-zone" id="drop-zone"></div>
            </div>
            <div id="error-message">请先放置核心组件！</div>
        </div>

        <!-- 4. 成功弹窗 (结构解析) -->
        <div id="success-modal" class="screen">
            <div class="modal-content">
                <h2>组装成功！</h2>
                <p>你总共用时: <span id="final-time">00:00</span></p>
                <div class="structure-info" id="structure-info">
                    <!-- 结构信息将动态生成在这里 -->
                </div>
                <button id="restart-button">重新挑战</button>
            </div>
        </div>

    </div>

    <script>
        // --- 游戏状态和数据 ---
        let currentVirus = null;
        let assemblyStartTime = null;
        let assemblyTimerInterval = null;
        let assembledParts = {}; // 记录已正确组装的组件

        // 病毒数据定义 (MVP)
        const virusData = {
            covid: {
                name: "新冠病毒 (SARS-CoV-2)",
                parts: [
                    { id: 'nucleic-acid', name: '核酸 (RNA)', type: 'nucleic-acid', isCore: true, description: '单股正链RNA，是病毒的遗传物质。' },
                    { id: 'protein-shell', name: '蛋白质外壳', type: 'protein-shell', isCore: false, description: '保护内部的核酸，并参与病毒的入侵过程。' },
                    { id: 'spike-protein', name: '刺突蛋白 (S蛋白)', type: 'spike-protein', isCore: false, description: '位于病毒表面，能识别并结合宿主细胞上的受体（如ACE2），是疫苗研发的重要靶点。' }
                ]
            },
            influenza: {
                name: "流感病毒",
                parts: [
                    { id: 'nucleic-acid', name: '核酸 (RNA)', type: 'nucleic-acid', isCore: true, description: '分节段的单股负链RNA。' },
                    { id: 'protein-shell', name: '蛋白质外壳', type: 'protein-shell', isCore: false, description: '由多种蛋白质组成，保护核酸。' },
                    { id: 'spike-protein', name: '血凝素 (H蛋白)', type: 'spike-protein', isCore: false, description: '帮助病毒附着在宿主细胞表面。' }
                ]
            }
        };

        // --- DOM 元素 ---
        const startScreen = document.getElementById('start-screen');
        const selectionScreen = document.getElementById('selection-screen');
        const assemblyScreen = document.getElementById('assembly-screen');
        const successModal = document.getElementById('success-modal');
        const startButton = document.getElementById('start-button');
        const virusCards = document.querySelectorAll('.virus-card');
        const partsBin = document.getElementById('parts-bin');
        const dropZone = document.getElementById('drop-zone');
        const errorMessage = document.getElementById('error-message');
        const currentVirusNameSpan = document.getElementById('current-virus-name');
        const timerSpan = document.getElementById('timer');
        const finalTimeSpan = document.getElementById('final-time');
        const structureInfoDiv = document.getElementById('structure-info');
        const restartButton = document.getElementById('restart-button');

        // --- 工具函数 ---
        function showScreen(screenElement) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            screenElement.classList.add('active');
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
            setTimeout(() => errorMessage.classList.remove('show'), 2000);
        }

        // --- 游戏逻辑 ---

        // 1. 开始游戏
        startButton.addEventListener('click', () => {
            showScreen(selectionScreen);
        });

        // 2. 选择病毒
        virusCards.forEach(card => {
            card.addEventListener('click', () => {
                const virusId = card.dataset.virus;
                currentVirus = virusData[virusId];
                startAssembly();
            });
        });

        // 3. 开始组装
        function startAssembly() {
            if (!currentVirus) return;

            // 重置状态
            assembledParts = {};
            partsBin.innerHTML = '';
            currentVirusNameSpan.textContent = currentVirus.name;
            
            // 生成病毒组件
            currentVirus.parts.forEach(part => {
                const partElement = document.createElement('div');
                partElement.classList.add('virus-part', part.type);
                partElement.textContent = part.name;
                partElement.draggable = true;
                partElement.dataset.partId = part.id;

                partElement.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', part.id);
                    partElement.classList.add('dragging');
                });
                partElement.addEventListener('dragend', () => {
                    partElement.classList.remove('dragging');
                });

                partsBin.appendChild(partElement);
            });

            // 开始计时
            let seconds = 0;
            assemblyTimerInterval = setInterval(() => {
                seconds++;
                timerSpan.textContent = `时间: ${formatTime(seconds)}`;
            }, 1000);

            showScreen(assemblyScreen);
        }

        // 4. 拖拽和放置逻辑
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault(); // 允许放置
            dropZone.classList.add('active');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('active');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('active');

            const partId = e.dataTransfer.getData('text/plain');
            const part = currentVirus.parts.find(p => p.id === partId);

            if (!part) return;

            // 简化的碰撞/组装逻辑
            // 规则：必须先组装核心组件 (isCore: true)
            const hasCore = Object.values(assembledParts).some(p => p.isCore);
            
            if (!hasCore && !part.isCore) {
                showError("请先放置核心组件（如核酸）！");
                return;
            }

            // 检查是否已组装
            if (assembledParts[partId]) {
                showError(`"${part.name}" 已经组装好了！`);
                return;
            }
            
            // 组装成功
            assembledParts[partId] = part;
            const partElement = document.querySelector(`.virus-part[data-part-id="${partId}"]`);
            if (partElement) partElement.remove(); // 从零件箱移除

            // 更新组装区域的视觉效果 (简化)
            if (part.isCore) {
                dropZone.innerHTML = `<div class="virus-part ${part.type}" style="width: 150px; height: 150px;">${part.name}</div>`;
            } else {
                // 在核心周围添加其他组件 (非常简化的视觉模拟)
                const newPart = document.createElement('div');
                newPart.classList.add('virus-part', part.type);
                newPart.textContent = part.name;
                newPart.style.position = 'absolute';
                // 随机分布在核心周围
                const angle = Math.random() * Math.PI * 2;
                const distance = 110; // 距离核心的距离
                newPart.style.left = `calc(50% + ${Math.cos(angle) * distance}px - 50px)`;
                newPart.style.top = `calc(50% + ${Math.sin(angle) * distance}px - 50px)`;
                dropZone.appendChild(newPart);
            }

            // 检查是否所有组件都已组装完毕
            if (Object.keys(assembledParts).length === currentVirus.parts.length) {
                completeAssembly();
            }
        });

        // 5. 完成组装
        function completeAssembly() {
            clearInterval(assemblyTimerInterval);
            const finalTime = timerSpan.textContent.replace('时间: ', '');
            finalTimeSpan.textContent = finalTime;

            // 生成结构解析信息
            structureInfoDiv.innerHTML = '';
            currentVirus.parts.forEach(part => {
                const infoP = document.createElement('p');
                infoP.innerHTML = `<strong>${part.name}:</strong> ${part.description}`;
                structureInfoDiv.appendChild(infoP);
            });

            showScreen(successModal);
        }

        // 6. 重新开始
        restartButton.addEventListener('click', () => {
            clearInterval(assemblyTimerInterval);
            showScreen(selectionScreen);
        });

    </script>
</body>
</html>